{% extends 'base/dashboard_base.html' %}
{% load static %}
{% load humanize %}

{% block page_title %}Dépense {{ depense.numero_depense }}{% endblock %}

{% block content %}
<div class="depense-detail" style="padding: 20px;">
    <div class="detail-card" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        <!-- En-tête -->
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
            <div>
                <h1 style="font-size: 28px; font-weight: 700; color: #1e293b; margin: 0 0 10px 0;">
                    Dépense {{ depense.numero_depense }}
                </h1>
                <div style="font-size: 16px; color: #64748b;">
                    {{ depense.fournisseur }}
                </div>
            </div>
            <span class="badge badge-{{ depense.statut|lower }}" style="padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;">
                {{ depense.get_statut_display }}
            </span>
        </div>

        <!-- Informations -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div>
                <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">Date</div>
                <div style="font-size: 16px; font-weight: 600;">{{ depense.date_depense|date:"d/m/Y" }}</div>
            </div>
            <div>
                <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">Catégorie</div>
                <div style="font-size: 16px; font-weight: 600;">{{ depense.get_categorie_display }}</div>
            </div>
            <div>
                <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">Montant</div>
                <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">
                    {{ depense.montant|floatformat:0|intcomma }} FCFA
                </div>
            </div>
            <div>
                <div style="font-size: 13px; color: #64748b; margin-bottom: 6px;">Mode de paiement</div>
                <div style="font-size: 16px; font-weight: 600;">{{ depense.mode_paiement }}</div>
            </div>
        </div>

        <!-- Description -->
        <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Description</h3>
            <p style="color: #64748b; line-height: 1.6;">{{ depense.description }}</p>
        </div>

        <!-- Pièce justificative -->
        {% if depense.piece_justificative %}
        <div style="margin-bottom: 30px;">
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">Pièce justificative</h3>
            <a href="{{ depense.piece_justificative.url }}"
               class="btn btn-secondary"
               target="_blank"
               style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; text-decoration: none; color: #64748b;">
                <i class="fas fa-download"></i>
                Télécharger
            </a>
        </div>
        {% endif %}

        <!-- Actions -->
        <div style="display: flex; gap: 12px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            {% if depense.statut == 'EN_ATTENTE' %}
            <button onclick="approuver()"
                    class="btn btn-success"
                    style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; cursor: pointer;">
                <i class="fas fa-check"></i>
                Approuver
            </button>
            <a href="{% url 'dashboard:comptable_depense_edit' depense.pk %}"
               class="btn btn-primary"
               style="padding: 10px 20px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                <i class="fas fa-edit"></i>
                Modifier
            </a>
            {% endif %}
            <a href="{% url 'dashboard:comptable_depenses' %}"
               class="btn btn-secondary"
               style="padding: 10px 20px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; color: #64748b; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
                <i class="fas fa-arrow-left"></i>
                Retour
            </a>
        </div>
    </div>
</div>

<script>
function approuver() {
    if (confirm('Voulez-vous approuver cette dépense ?')) {
        fetch('{% url "dashboard:comptable_depense_approuver" depense.pk %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert(data.error);
            }
        });
    }
}
</script>
{% endblock %}