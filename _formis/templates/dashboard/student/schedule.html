{% extends 'base/dashboard_base.html' %}
{% load static %}

{% block page_title %}Emploi du Temps - Apprenant{% endblock %}
{% block breadcrumb %}Emploi du temps{% endblock %}

{% block content %}
<div class="schedule-page">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-calendar-alt"></i>
            Emploi du Temps
        </h1>
        <div class="schedule-actions">
            <button class="btn btn-outline" onclick="printSchedule()">
                <i class="fas fa-print"></i> Imprimer
            </button>
            <button class="btn btn-primary" onclick="exportSchedule()">
                <i class="fas fa-download"></i> Exporter
            </button>
        </div>
    </div>

    {% if classe_attribuee %}
    <div class="class-info">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            Emploi du temps de la classe: <strong>{{ classe_attribuee.nom }}</strong>
        </div>
    </div>
    {% endif %}

    <div class="schedule-container">
        <div class="schedule-week-selector">
            <button class="btn btn-sm btn-outline" onclick="previousWeek()">
                <i class="fas fa-chevron-left"></i> Semaine précédente
            </button>
            <span class="current-week" id="currentWeek">Semaine du {{ current_week_start|date:"d/m/Y" }}</span>
            <button class="btn btn-sm btn-outline" onclick="nextWeek()">
                Semaine suivante <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="schedule-table">
            <div class="schedule-header">
                <div class="time-column">Heure</div>
                {% for jour in jours %}
                <div class="day-column">{{ jour }}</div>
                {% endfor %}
            </div>
            
            <div class="schedule-body">
                <!-- Exemple de plages horaires (à adapter selon vos besoins) -->
                {% for heure in heures %}
                <div class="schedule-row">
                    <div class="time-slot">{{ heure }}</div>
                    {% for jour in jours %}
                    <div class="course-slot" data-day="{{ jour }}" data-hour="{{ heure }}">
                        {% for emploi in emploi_par_jour %}
                            {% if emploi.heure_debut|time:"H:i" == heure %}
                            <div class="course-event">
                                <strong>{{ emploi.cours.matiere.nom }}</strong>
                                <small>{{ emploi.cours.enseignant.get_full_name }}</small>
                                <small>Salle {{ emploi.salle.nom }}</small>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<style>
.schedule-page {
    padding: 20px;
}

.schedule-actions {
    display: flex;
    gap: 10px;
}

.schedule-container {
    margin-top: 20px;
}

.schedule-week-selector {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.current-week {
    font-weight: 600;
    font-size: 1.1em;
}

.schedule-table {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.schedule-header {
    display: grid;
    grid-template-columns: 100px repeat(7, 1fr);
    background: #4e73df;
    color: white;
}

.time-column, .day-column {
    padding: 15px;
    text-align: center;
    font-weight: 600;
}

.schedule-body {
    display: grid;
    grid-template-rows: repeat(auto-fit, 80px);
}

.schedule-row {
    display: grid;
    grid-template-columns: 100px repeat(7, 1fr);
    border-bottom: 1px solid #eee;
}

.schedule-row:last-child {
    border-bottom: none;
}

.time-slot {
    padding: 10px;
    text-align: center;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 500;
}

.course-slot {
    padding: 5px;
    border-right: 1px solid #eee;
    min-height: 80px;
}

.course-slot:last-child {
    border-right: none;
}

.course-event {
    background: #e3f2fd;
    border-left: 4px solid #2196f3;
    padding: 8px;
    border-radius: 4px;
    height: 100%;
    font-size: 0.8em;
}

.course-event strong {
    display: block;
    margin-bottom: 2px;
}

.course-event small {
    display: block;
    color: #666;
}
</style>

<script>
let currentDate = new Date();

function updateWeekDisplay() {
    const startOfWeek = new Date(currentDate);
    startOfWeek.setDate(currentDate.getDate() - currentDate.getDay() + 1);
    
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    
    document.getElementById('currentWeek').textContent = 
        `Semaine du ${formatDate(startOfWeek)} au ${formatDate(endOfWeek)}`;
}

function formatDate(date) {
    return date.toLocaleDateString('fr-FR');
}

function previousWeek() {
    currentDate.setDate(currentDate.getDate() - 7);
    updateWeekDisplay();
    loadScheduleData();
}

function nextWeek() {
    currentDate.setDate(currentDate.getDate() + 7);
    updateWeekDisplay();
    loadScheduleData();
}

function loadScheduleData() {
    // Implémenter le chargement des données de l'emploi du temps
    console.log('Chargement des données pour la semaine:', currentDate);
}

function printSchedule() {
    window.print();
}

function exportSchedule() {
    // Implémenter l'export PDF/Excel
    alert('Fonction d\'export à implémenter');
}

// Initialisation
updateWeekDisplay();
</script>
{% endblock %}